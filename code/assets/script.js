const products = {
    "face-care": [
        {
            name: "Cetaphil Face Wash",
            img: "https://pixies.in/media/catalog/product/cache/e9780188a08ae15edb442fcb34502371/c/e/cetaphil_gentle_skin_cleanser_125ml__1_1.jpg",
            ingredients: "Water, Glycerin, Niacinamide, Panthenol, Cetyl Alcohol",
            uses: "Gently cleanses, reduces redness, hydrates",
            skinType: "Sensitive & Dry Skin",
            price: 299
        },
        {
            "name": "Khadi Natural Papaya Face Wash",
            "img": "https://m.media-amazon.com/images/I/51NGpOZKESL._AC_UF1000,1000_QL80_.jpg",
            "ingredients": "Papaya Extract, Aloe Vera, Neem, Glycerin, Aqua",
            "uses": "Brightens skin, reduces dark spots & blemishes, gently cleanses",
            "skinType": "All Skin Types",
            "price": 171
          },
          {
            "name": "Khadi Essentials Neem Face Wash",
            "img": "https://khadiessentials.com/cdn/shop/products/734439060303_1.jpg?v=1669645957",
            "ingredients": "Neem, Aloe Vera, Tea Tree, Aqua",
            "uses": "Fights acne, reduces pimples, soothes and brightens skin",
            "skinType": "All Skin Types (Best for Acne-prone)",
            "price": 325
          },
          
          {
            "name": "Nat Habit Ubtan Face Wash",
            "img": "https://nathabit.in/_nat/images/website_de632372c2.jpg?format=auto&width=1920&quality=75",
            "ingredients": "Wild Turmeric, Chickpea Flour, Sandalwood, Rose, Aloe Vera",
            "uses": "Brightens skin, deep cleanses, improves skin texture",
            "skinType": "All Skin Types",
            "price": 275
          },
          {
            "name": "Just Herbs Brightening Face Wash",
            "img": "https://m.media-amazon.com/images/I/61stHma03PL._AC_UF1000,1000_QL80_.jpg",
            "ingredients": "Vitamin C, Amla, Liquorice Root, Aloe Vera, Aqua",
            "uses": "Brightens skin, reduces hyperpigmentation, maintains skin pH, hydrates",
            "skinType": "All Skin Types",
            "price": 225
          },
          {
            "name": "NEEV SOAPS Kumkumadi Face Scrub Soap",
            "img": "https://m.media-amazon.com/images/I/81ZOcN5NkuL.jpg",
            "ingredients": "Kumkumadi Oil, Saffron, Turmeric, Sandalwood, Almond Oil",
            "uses": "Brightens skin, smoothens texture, gives radiant glow",
            "skinType": "All Skin Types",
            "price": 199
          },
          
          {
            "name": "Etheric Face & Body Wash Herbal Powder",
            "img": "https://m.media-amazon.com/images/I/71ORbOICn9L._AC_UF1000,1000_QL80_.jpg",
            "ingredients": "Sandalwood, Rose Petals, Orange Peel, Multani Mitti, Tulsi",
            "uses": "Cleanses skin naturally, removes excess oil, improves skin tone",
            "skinType": "All Skin Types",
            "price": 150
          },
          {
            "name": "Plantalore Herbals Masoor Dal Moisturizing Facewash Powder",
            "img": "https://rukminim3.flixcart.com/image/850/1000/jnun1jk0/face-wash/k/c/f/100-masoor-dal-face-wash-powder-plantalore-original-imafaessnaqrapvh.jpeg?q=20&crop=false",
            "ingredients": "Masoor Dal (Red Lentil) Powder",
            "uses": "Moisturizes skin, provides gentle exfoliation, enhances skin softness",
            "skinType": "All Skin Types",
            "price": 215
          },
          {
            "name": "Pavitra+ Organic Activated Charcoal Acne Oil and Pollution Control Face Wash",
            "img": "https://www.jiomart.com/images/product/original/rv9v10opmp/pavitraplus-organic-activated-charcoal-acne-oil-and-pollution-control-face-wash-100ml-product-images-orv9v10opmp-p596834521-0-202212311927.jpg?im=Resize=(1000,1000)",
            "ingredients": "Organic Activated Charcoal Powder, Pomegranate Oil, Organic Aloe Vera, Citric Acid, Vitamin E",
            "uses": "Deep cleanses, reduces acne and pimples, hydrates skin, controls oil",
            "skinType": "All Skin Types, Combination Skin",
            "price": 205
          },
          {
            "name": "Rustic Art Organic Neem Basil Face Wash Concentrate",
            "img": "https://www.rusticart.in/cdn/shop/files/Facewash50g_1_1024x.jpg?v=1706069195",
            "ingredients": "Coconut Oil, Karanja Seed Oil, Sunflower Seed Oil, Castor Seed Oil, Flax Seed Oil, Neem Seed Oil, Vegetable Glycerin, Basil Oil, Lavender Flower Oil, Lemongrass Oil",
            "uses": "Deep cleanses, controls acne, antibacterial and antifungal properties",
            "skinType": "Oily to Normal & Acne-Prone Skin",
            "price": 200
          },
          
          
        {
            name: "Minimalist Oat Extract Face Wash",
            img: "https://m.media-amazon.com/images/I/61W6HQfb69L.jpg",
            ingredients: "Oat Extract, Beta-Glucan, Glycerin, Sodium Cocoyl Isethionate",
            uses: "Hydrates skin, removes dirt, strengthens skin barrier",
            skinType: "Dry & Combination Skin",
            price: 349
        },
        {
            name: "Naturals Aloe Vera Face Wash",
            img: "https://m.media-amazon.com/images/I/61Lqe20SeXL.jpg",
            ingredients: "Aloe Vera, Neem Extract, Vitamin E, Green Tea Extract",
            uses: "Deeply cleanses, fights acne, hydrates skin",
            skinType: "Oily, Acne-Prone & Normal Skin",
            price: 199
        }
    ],
    "shampoos": [
    {
        name: "Herbal Shampoo",
        img: "https://rukminim2.flixcart.com/image/850/1250/xif0q/shampoo/e/x/k/-original-imagrh53hzgyuzgy.jpeg?q=20&crop=false",
        ingredients: "Amla, Shikakai, Reetha",
        uses: "Strengthens hair, prevents dandruff",
        hairType: "All Hair Types",
        price: 499
    },
    {
        name: "Aloe Vera Shampoo",
        img: "https://www.rusticart.in/cdn/shop/files/AloeClarySageShampoo1_1024x.jpg?v=1696750643",
        ingredients: "Aloe Vera, Clary Sage Oil",
        uses: "Moisturizes scalp, reduces hair fall",
        hairType: "Dry & Frizzy Hair",
        price: 599
    }
],

        "conditioners": [
        {
            name: "Coconut Milk Conditioner",
            img: "https://www.google.com/imgres?q=coconut%20milk%20conditioner%20for%20natural&imgurl=https%3A%2F%2Fm.media-amazon.com%2Fimages%2FI%2F61G7eQs6dPL.jpg&imgrefurl=https%3A%2F%2Fwww.amazon.in%2FWOW-Coconut-Milk-Conditioner-Silicones%2Fdp%2FB07BTKRF9J&docid=bp7gEUE5wXAPxM&tbnid=CCfuEaKMbW4o1M&vet=12ahUKEwiKveadlvCMAxWjyjgGHXFeL74QM3oECBsQAA..i&w=1080&h=1080&hcb=2&ved=2ahUKEwiKveadlvCMAxWjyjgGHXFeL74QM3oECBsQAA",
            ingredients: "Coconut Milk, Vitamin E",
            uses: "Deep conditioning, frizz control",
            hairType: "Dry & Damaged Hair",
            price: 349
        },
       
    ],
    "serums": [
        {
            name: "Argan Hair Serum",
            img: "https://m.media-amazon.com/images/I/51dUwlLWiLL._SL1000_.jpg",
            ingredients: "Argan Oil, Jojoba Oil",
            uses: "Adds shine, tames frizz",
            hairType: "All Hair Types",
            price: 299
        },
        {
            name: "Keratin Smooth Serum",
            img: "https://m.media-amazon.com/images/I/61vjTnOt+qL._SL1500_.jpg",
            ingredients: "Keratin, Vitamin B5",
            uses: "Smooths hair, detangles instantly",
            hairType: "Frizzy Hair",
            price: 449
        }
    ],
    "hair-wax": [
        {
            name: "Strong Hold Hair Wax",
            img: "https://m.media-amazon.com/images/I/61vxXpKJWoL._SL1500_.jpg",
            ingredients: "Beeswax, Aloe Vera",
            uses: "Style and hold hair all day",
            hairType: "All Hair Types",
            price: 275
        },
        {
            name: "Matte Finish Hair Wax",
            img: "https://m.media-amazon.com/images/I/71nDbhZHDKL._SL1500_.jpg",
            ingredients: "Clay, Almond Oil",
            uses: "Textured matte finish for short hair",
            hairType: "Oily Hair",
            price: 320
        }
    ],
    "beard-oil": [
        {
            name: "Cedarwood Beard Oil",
            img: "https://m.media-amazon.com/images/I/61eCJAGNLUL._SL1500_.jpg",
            ingredients: "Cedarwood Oil, Jojoba Oil",
            uses: "Softens beard, promotes growth",
            hairType: "All Beard Types",
            price: 199
        },
        {
            name: "Herbal Beard Oil",
            img: "https://m.media-amazon.com/images/I/71XqfQHaVKL._SL1500_.jpg",
            ingredients: "Neem, Tea Tree Oil",
            uses: "Reduces itchiness, nourishes roots",
            hairType: "Sensitive Skin",
            price: 249
        }
    ],


    "hair-oils": [
        {
            name: "Rosemary Lavender Healthy Hair Oil",
            img: "https://images.apollo247.in/pub/media/catalog/product/s/o/sou0077_1-june-_1_.jpg",
            ingredients: "Rosemary, Lavender, Coconut Oil, Jojoba Oil",
            uses: "Promotes hair growth, reduces hair fall, nourishes scalp",
            hairType: "All Hair Types",
            price: 599
        },
        {
            name: "AYURVEDASHREE Amla Hair Oil",
            img: "https://m.media-amazon.com/images/I/81XRoiI-MHL.jpg",
            ingredients: "Amla Oil, Bhringraj Oil, Brahmi Oil, Tulsi Oil, Almond Oil, Argan Oil, Moringa Oil, Clove Oil",
            uses: "Strengthens hair roots, reduces hair fall, promotes hair growth, nourishes scalp",
            hairType: "All Hair Types",
            price: 399
        },
        {
            
            name: "Avimee Herbal Javakusum Hibiscus Oil",
            img: "https://m.media-amazon.com/images/I/71sBza6xclL.jpg",
            ingredients: "Hibiscus, Vitamin C, Coconut Oil, Bhringraj, Amla, Brahmi",
            uses: "Promotes hair growth, strengthens roots, reduces dandruff, adds shine",
             hairType: "All Hair Types",
             price: 349
        },
        {
            name: "Hibiscus Amla Winter Hair Oil",
            img: "https://img.tatacliq.com/images/i13/437Wx649H/MP000000019307183_437Wx649H_202309172030261.jpeg",
            ingredients: "Hibiscus, Amla, Coconut Oil, Bhringraj, Almond Oil",
            uses: "Deeply nourishes hair, prevents dryness, strengthens roots, promotes hair growth",
            hairType: "All Hair Types",
            price: 429
        },
        {
            name: "Krishna's Kesharogyam Ayurvedic Hair Oil",
            img: "https://m.media-amazon.com/images/I/61FCx+Dq-BL._AC_UF1000,1000_QL80_.jpg",
            ingredients: "Amla, Jatamansi, Bhringraj, Brahmi, Neem, Hibiscus, Coconut Oil, Almond Oil, and 8 more Ayurvedic herbs",
            uses: "Strengthens hair, promotes hair growth, reduces dandruff, nourishes scalp",
            hairType: "All Hair Types",
            price: 499
        },
        {
            name: "Kottakkal Ayurveda® Nilibhringadi Tailam",
            img: "https://shop.aryavaidyasala.com/pub/media/catalog/product/cache/423329bdf96203c3a8397ed04f3bb6ff/f/r/front_3_16.jpg",
            ingredients: "Bhringraj, Neeli (Indigo), Amla, Coconut Oil, Yashtimadhu, Bala",
            uses: "Promotes hair growth, reduces hair fall, strengthens scalp, prevents dandruff",
            hairType: "All Hair Types",
            price: 599
        },
        {
            name: "Durdurapathradi Hair Oil",
            img: "https://www.ayurkart.com/cdn/shop/products/Durdurapathradi-Keram-kerala-ayurveda_1200x1200.jpg?v=1715885919",
            ingredients: "Durdurapatra (Thorn Apple), Coconut Oil, Bhringraj, Amla, Neem",
            uses: "Helps reduce dandruff, strengthens hair roots, nourishes scalp, promotes hair growth",
            hairType: "All Hair Types",
            price: 449
        },
        {
            name: "Mahabhringraj Hair Oil",
            img: "https://m.media-amazon.com/images/I/61AYSwGG3iL.jpg",
            ingredients: "Bhringraj, Amla, Brahmi, Neem, Coconut Oil, Sesame Oil",
            uses: "Promotes hair growth, prevents premature graying, strengthens hair roots, reduces dandruff",
            hairType: "All Hair Types",
            price: 499
        },
        {
            name: "Patanjali Divya Kesh Tail",
            img: "https://m.media-amazon.com/images/I/51e8CIChlYL._AC_UF1000,1000_QL80_.jpg",
            ingredients: "Bhringraj, Amla, Brahmi, Neem, Jatamansi, Manjistha, Coconut Oil, Sesame Oil",
            uses: "Strengthens hair roots, promotes hair growth, reduces dandruff, prevents premature graying",
            hairType: "All Hair Types",
            price: 399
        },
        {
            name: "Mamaearth Rosemary Hair Oil",
            img: "https://images.mamaearth.in/catalog/product/3/_/3_1.png?format=auto&height=600",
            ingredients: "Rosemary Oil, Bhringraj, Amla, Coconut Oil, Castor Oil",
            uses: "Promotes hair growth, strengthens roots, reduces dandruff, nourishes scalp",
            hairType: "All Hair Types",
            price: 499
        },
        {
            name: "Wow 10 in 1 Hair Oil",
            img: "https://m.media-amazon.com/images/I/81yL-czavRL._AC_UF1000,1000_QL80_.jpg",
            ingredients: "Argan Oil, Jojoba Oil, Almond Oil, Olive Oil, Coconut Oil, Castor Oil, Bhringraj, Amla, Tea Tree Oil, Vitamin E",
            uses: "Nourishes scalp, reduces hair fall, promotes hair growth, adds shine, prevents split ends",
            hairType: "All Hair Types",
            price: 599
        },
        {
            name: "Indulekha Bhringa Hair Oil",
            img: "https://m.media-amazon.com/images/I/51yyH9QUugL.jpg",
            ingredients: "Bhringraj, Amla, Coconut Oil, Neem, Brahmi, Vitamin E",
            uses: "Promotes hair growth, reduces hair fall, strengthens roots, nourishes scalp",
            hairType: "All Hair Types",
            price: 699
        }
     ],       
    
    "raw-herbs": [
        {
            name: "Raw Amla Powder",
            img: "https://i.etsystatic.com/22112904/r/il/e1bab4/2943112711/il_570xN.2943112711_4d2y.jpg",
            ingredients: "100% Amla Powder",
            uses: "Boosts hair growth, improves digestion",
            skinType: "All Skin & Hair Types",
            price: 299
        }
    ],

    "soap": [
    {
        name: "Soulflower Handmade Herbal Soap",
        img: "https://www.soulflower.in/cdn/shop/files/Sweet-Rose-Natural-Soap.webp?v=1742820729",
        ingredients: "Activated Charcoal, Tea Tree Oil, Glycerin",
        uses: "Cleanses deeply, detoxifies skin, treats acne",
        skinType: "Oily & Acne-prone Skin",
        price: 250,
        weight: "150 g"
    },
    {
        name: "Khadi Natural Sandalwood Soap",
        img: "https://www.khadinatural.com/cdn/shop/files/Artboard1copy_da5d3e8b-3c82-489c-a678-98044a3edb9a.jpg?v=1742798189",
        ingredients: "Sandalwood Oil, Glycerin, Essential Oils",
        uses: "Moisturizes and soothes skin, mild fragrance",
        skinType: "All Skin Types",
        price: 80,
        weight: "125 g"
    }
],
"body-wash": [
    {
        name: "The Body Shop British Rose Shower Gel",
        img: "https://m.media-amazon.com/images/I/71z+rTVXIiL.jpg",
        ingredients: "Rose Extract, Glycerin",
        uses: "Gently cleanses, leaves a fresh floral scent",
        skinType: "Normal to Dry Skin",
        price: 345,
        weight: "250 ml"
    },
    {
        name: "Biotique Bio Apricot Refreshing Body Wash",
        img: "https://www.biotique.com/cdn/shop/files/8904352004698_1-min.jpg?v=1668074883",
        ingredients: "Apricot Kernel Oil, Wild Turmeric, Soap Nut",
        uses: "Cleanses without drying, revitalizes skin",
        skinType: "All Skin Types",
        price: 180,
        weight: "200 ml"
    }
],
"deodorants": [
    {
        name: "Bella Vita Organic Deo White Natural Deodorant Roll-On",
        img: "https://m.media-amazon.com/images/I/61LY83qmUvL.jpg",
        ingredients: "Coconut Oil, Aloe Vera, Cucumber Extract",
        uses: "Whitens underarms, provides long-lasting freshness",
        skinType: "Sensitive Skin",
        price: 199,
        weight: "75 ml"
    },
    {
        name: "Vilvah Natural Deodorant - Lavender & Bergamot",
        img: "https://www.vilvahstore.com/cdn/shop/files/lavender-deo-shot_white_1.jpg?v=1693545892",
        ingredients: "Shea Butter, Coconut Oil, Arrowroot Powder, Lavender Oil",
        uses: "Neutralizes odor naturally, skin-friendly formula",
        skinType: "All Skin Types",
        price: 290,
        weight: "50 g"
    }
]
};

// Initialize cart from localStorage if available
let cart = JSON.parse(localStorage.getItem('cart')) || [];

// Current active category
let currentCategory = 'face-care';

// Add category and index to each product
function prepareProducts() {
    Object.keys(products).forEach(category => {
        products[category].forEach((product, index) => {
            product.category = category;
            product.index = index;
        });
    });
}

function showCategory(category, event = null) {
    // Prevent default if coming from click event
    if (event) event.preventDefault();
    
    currentCategory = category;
    
    // Update active tab in navigation
    document.querySelectorAll('nav ul li a').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('onclick')?.includes(category)) {
            link.classList.add('active');
        }
    });
    
    // Update active tab in dropdown
    document.querySelectorAll('.dropdown-menu a').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('onclick')?.includes(category)) {
            link.classList.add('active');
        }
    });
    
    if (!products[category] || products[category].length === 0) {
        document.getElementById('content').innerHTML = `<p>No products available in this category.</p>`;
        return;
    }
    
    document.getElementById('content').innerHTML = `
        <h2>${category.replace(/-/g, ' ').toUpperCase()}</h2>
        <div class="products-grid">
            ${products[category].map((product, index) => `
                <div class="product-card" onclick="showProduct('${category}', ${index})">
                    <img src="${product.img}" alt="${product.name}">
                    <h3>${product.name}</h3>
                    <p>₹${product.price}</p>
                    <button class="add-to-cart-btn" onclick="event.stopPropagation(); addToCart('${category}', ${index})">Add to Cart</button>
                </div>
            `).join('')}
        </div>
    `;
}

function showHome() {
    let welcomeMsg = "Explore our natural, chemical-free skincare and haircare products.";
    
    document.getElementById('content').innerHTML = `
        <h2>Welcome to Herbal Bliss</h2>
        <p>${welcomeMsg}</p>
        <div class="featured-products">
            <h3>Featured Products</h3>
            <div class="products-grid">
                ${getFeaturedProducts().map(product => `
                    <div class="product-card" onclick="showProduct('${product.category}', ${product.index})">
                        <img src="${product.img}" alt="${product.name}">
                        <h4>${product.name}</h4>
                        <p>₹${product.price}</p>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

function getFeaturedProducts() {
    let featured = [];
    Object.keys(products).forEach(category => {
        const categoryProducts = [...products[category]];
        featured = featured.concat(
            categoryProducts.sort(() => 0.5 - Math.random()).slice(0, 2)
        );
    });
    return featured.sort(() => 0.5 - Math.random()).slice(0, 6);
}

// ... rest of your existing functions (addToCart, removeFromCart, etc.) ...

function showProduct(category, index) {
    let product = products[category][index];

    document.getElementById('content').innerHTML = `
        <div class="product-container">
            <div class="product-image">
                <img src="${product.img}" class="animated-img">
                <button class="add-to-cart-btn" onclick="addToCart('${category}', ${index})">Add to Cart - ₹${product.price}</button>
            </div>
            <div class="product-details">
                <h2>${product.name}</h2>
                <p><strong>Price:</strong> ₹${product.price}</p>
                <h3>Ingredients</h3>
                <p>${product.ingredients}</p>
                <h3>Uses</h3>
                <p>${product.uses}</p>
                <h3>Suitable For</h3>
                <p>${product.skinType || product.hairType}</p>
            </div>
        </div>
    `;
}

function removeFromCart(index) {
    cart.splice(index, 1);
    showCart();
}

// Update cart in localStorage
function updateCartStorage() {
    localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById("cart-count").innerText = cart.length;
}

// Initialize cart on page load
document.addEventListener('DOMContentLoaded', function() {
    prepareProducts();
    
    // Load cart from localStorage
    let savedCart = localStorage.getItem('cart');
    if (savedCart) {
        cart = JSON.parse(savedCart);
    }
    
    updateCartStorage();
    showHome();
});

// Modified addToCart function
function addToCart(category, index) {
    let product = products[category][index];
    product.quantity = product.quantity || 1; // Initialize quantity
    
    // Check if product already exists in cart
    let existingItem = cart.find(item => 
        item.name === product.name && item.price === product.price
    );
    
    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push(product);
    }
    
    updateCartStorage();
    alert("Added to Cart!");
}
// Modified showCart function
function showCart() {
    let html = `<h2>Your Cart</h2>`;
    let totalPrice = 0;
    
    if (cart.length === 0) {
        html += `<p>Your cart is empty.</p>`;
    } else {
        html += `<table>
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                    <th>Qty</th>
                    <th>Subtotal</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>`;
        
        cart.forEach((item, index) => {
            let subtotal = item.price * (item.quantity || 1);
            totalPrice += subtotal;
            
            html += `
                <tr>
                    <td>
                        <img src="${item.img}" width="50" height="50">
                        ${item.name}
                    </td>
                    <td>₹${item.price.toFixed(2)}</td>
                    <td>
                        <input type="number" min="1" value="${item.quantity || 1}" 
                               onchange="updateQuantity(${index}, this.value)">
                    </td>
                    <td>₹${subtotal.toFixed(2)}</td>
                    <td>
                        <button onclick="removeFromCart(${index})">Remove</button>
                    </td>
                </tr>
            `;
        });
        
        html += `</tbody></table>`;
        html += `<div class="cart-total">Total: ₹${totalPrice.toFixed(2)}</div>`;
        html += `<button onclick="checkout()" class="checkout-btn">Proceed to Checkout</button>`;
    }
    
    document.getElementById('content').innerHTML = html;
    updateCartStorage();
}

function updateQuantity(index, newQuantity) {
    if (newQuantity > 0) {
        cart[index].quantity = parseInt(newQuantity);
        showCart();
    }
}

// Modified checkout function to redirect to checkout.php
function checkout(amount) {
    // Save cart to session for PHP processing
    fetch('save_cart.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(cart)
    })
    .then(response => {
        if (response.ok) {
            window.location.href = 'checkout.php';
        } else {
            alert('Error saving cart. Please try again.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
    });
}

// Add this near the top with other global variables
let allProducts = [];

// Modify the prepareProducts function to also populate allProducts
function prepareProducts() {
    allProducts = []; // Reset the array
    Object.keys(products).forEach(category => {
        products[category].forEach((product, index) => {
            product.category = category;
            product.index = index;
            allProducts.push(product); // Add to allProducts array
        });
    });
}

// Search function
function searchProducts() {
    const searchTerm = document.getElementById('search-bar').value.toLowerCase().trim();
    
    if (!searchTerm) {
        showHome();
        return;
    }
    
    const results = allProducts.filter(product => 
        product.name.toLowerCase().includes(searchTerm) ||
        (product.ingredients && product.ingredients.toLowerCase().includes(searchTerm)) ||
        (product.uses && product.uses.toLowerCase().includes(searchTerm)) ||
        (product.skinType && product.skinType.toLowerCase().includes(searchTerm)) ||
        (product.hairType && product.hairType.toLowerCase().includes(searchTerm)));
    
    displaySearchResults(results, searchTerm);
}

// Function to display search results
function displaySearchResults(results, searchTerm) {
    if (results.length === 0) {
        document.getElementById('content').innerHTML = `
            <h2>Search Results for "${searchTerm}"</h2>
            <p>No products found matching your search.</p>
        `;
        return;
    }
    
    document.getElementById('content').innerHTML = `
        <h2>Search Results for "${searchTerm}"</h2>
        <div class="products-grid">
            ${results.map(product => `
                <div class="product-card" onclick="showProduct('${product.category}', ${product.index})">
                    <img src="${product.img}" alt="${product.name}">
                    <h3>${product.name}</h3>
                    <p>₹${product.price}</p>
                    <button class="add-to-cart-btn" onclick="event.stopPropagation(); addToCart('${product.category}', ${product.index})">Add to Cart</button>
                </div>
            `).join('')}
        </div>
    `;
}

// Update the DOMContentLoaded event listener to include search setup
document.addEventListener('DOMContentLoaded', function() {
    prepareProducts();
    
    // Load cart from localStorage
    let savedCart = localStorage.getItem('cart');
    if (savedCart) {
        cart = JSON.parse(savedCart);
    }
    
    updateCartStorage();
    showHome();
    
    // Add event listener for search input
    const searchInput = document.getElementById('search-bar');
    if (searchInput) {
        searchInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });
    }
});